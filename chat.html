// Fonction pour afficher un message, on met self si c'est toi qui envoie
function displayMessage(msg, self = false) {
  const chatBox = document.getElementById('chat-box');
  const div = document.createElement('div');
  div.classList.add('message');
  if (self) div.classList.add('self');
  div.innerHTML = `<span class="username">${msg.username}</span><span class="time">${msg.time}</span><div class="text">${msg.text}</div>`;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Charger les messages du salon actif
function loadMessages(channel) {
  const chatBox = document.getElementById('chat-box');
  chatBox.innerHTML = '';
  if (!messagesDB[channel]) return;
  messagesDB[channel].forEach(msg => {
    displayMessage(msg, msg.username === pseudo);
  });
}

// Envoyer un message dans le salon actif
form.addEventListener('submit', e => {
  e.preventDefault();
  const text = input.value.trim();
  if (!text) return;

  const now = new Date();
  const time = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');

  const message = {
    username: pseudo,
    text: text,
    time: time,
  };

  if (!messagesDB[activeChannel]) messagesDB[activeChannel] = [];
  messagesDB[activeChannel].push(message);

  // Si on est dans le salon actif, on affiche directement
  displayMessage(message, true);

  input.value = '';
});
